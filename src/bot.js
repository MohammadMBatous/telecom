import { Telegraf, Markup } from "telegraf";
import { token } from "../config/config.js";
import Storage from "node-persist";
export const bot = new Telegraf(token);

(async () => {
  try {
    await Storage.init();
  } catch (error) {
    console.error("ğŸ”´ Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ®Ø²ÙŠÙ†ØŒ Ø³ÙŠØªÙ… Ø­Ø°ÙÙ‡ ÙˆØ¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¦Ù‡...");
    await Storage.clear();
    await Storage.init();
  }
})();

bot.start((ctx) =>

  ctx.reply(
    `Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ø¨ÙˆØª Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ Ø§ØªØµØ§Ù„Ø§Øª Ø³ÙˆØ±ÙŠØ§ğŸ“±â˜ \n Ù…Ù† ÙØ¶Ù„Ùƒ  ÙŠØ§ ${ctx.from.first_name} Ø§Ø®ØªØ± Ù…Ø§Ø°Ø§ ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ Ù…Ù† Ø®Ù„Ø§Ù„ Ø´Ø±ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø³ÙÙ„Ù‰`,
    {
      reply_markup: {
        keyboard: [
          [
            { text: "Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ" },
            { text: "Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø®Ø¯Ù…Ø§Øª" },
          ],
          [{ text: "Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù‚ØªØ±Ø§Ø­ Ø£Ùˆ Ø´ÙƒÙˆÙ‰" }, { text: "Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ø¦Ø¹Ø©" }],
          [{text:"ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø®Ø¯Ù…Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†"}],
        ],
        resize_keyboard: true,
      },
    }
  )
);
bot.hears("Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ", async (ctx) => {

  ctx.reply(
    `Ù…Ù† ÙØ¶Ù„Ùƒ ÙŠØ§ ${ctx.from.first_name} Ù‚Ù… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙˆÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ Ø§ØªØµØ§Ù„Ø§Øª Ø³ÙˆØ±ÙŠØ§ \n ğŸ”´ ÙƒÙ„ ÙˆØ§Ø­Ø¯Ø© ÙÙŠ Ø±Ø³Ø§Ù„Ø© Ù…Ù†ÙØµÙ„Ø©`
  );
  console.log(ctx.from.first_name);
  console.log(ctx.from.id);
  console.log(ctx.from.username);
  await Storage.setItem(`balance-${ctx.from.id}`, true);
  await Storage.setItem(`username-${ctx.from.id}`, false);
});

bot.hears("Ø§Ù„Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø§Ù„Ø®Ø¯Ù…Ø§Øª", async (ctx) => {
  const messageprice = await ctx.reply("Ø¬Ø§Ø±ÙŠ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ø´Ø±Ø© ..");
  await ctx.replyWithPhoto({ source: "./src/images/prices_image.jpg" });
  await ctx.telegram.editMessageText(
    ctx.chat.id,
    messageprice.message_id,
    undefined,
    "ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ù†Ø´Ø±Ø© Ø¨Ù†Ø¬Ø§Ø­ âœ…"
  );
});

bot.hears("Ø£Ø³Ø¦Ù„Ø© Ø´Ø§Ø¦Ø¹Ø©", (ctx) => {
    ctx.reply(`
1- ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØŸ ğŸ’°
Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ÙŠÙ…ÙƒÙ†Ùƒ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø­Ø³Ø§Ø¨Ùƒ Ø¹Ù„Ù‰ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ Ù…Ù† Ø®Ù„Ø§Ù„ Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³ØªÙØ³Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ. ğŸ“±

2- ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯ØŸ ğŸ”‹
Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ÙŠÙ…ÙƒÙ†Ùƒ Ø´Ø­Ù† Ø§Ù„Ø±ØµÙŠØ¯ Ø¹Ø¨Ø± Ø´Ø§Ù… ÙƒØ§Ø´ Ø£Ùˆ Ù…Ù† Ø®Ù„Ø§Ù„ Ù…Ø±Ø§ÙƒØ² Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©. ğŸ’³

3- ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŸ ğŸ”‘
Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: Ù„ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±ØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¥Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ ÙˆØ§Ø®ØªÙŠØ§Ø± "ØªØºÙŠÙŠØ± ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±"ØŒ Ø«Ù… Ø§ØªØ¨Ø¹ Ø§Ù„ØªØ¹Ù„ÙŠÙ…Ø§Øª. ğŸ› ï¸

4- ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø©ØŸ âŒ
Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¹Ø¨Ø± Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø±Ø³Ù…ÙŠ Ø£Ùˆ Ù…Ù† Ø®Ù„Ø§Ù„ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ. ğŸ“

5- ÙƒÙŠÙ ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠØŸ ğŸ†˜
Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©: ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ Ø¹Ø¨Ø± Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ Ø£Ùˆ Ù…Ù† Ø®Ù„Ø§Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© Ø§Ù„Ù…Ø¨Ø§Ø´Ø±Ø© ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚. ğŸ’¬
 `);
        
});

bot.hears("Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù‚ØªØ±Ø§Ø­ Ø£Ùˆ Ø´ÙƒÙˆÙ‰", async (ctx) => {
    ctx.reply(
        `Ù…Ù† ÙØ¶Ù„Ùƒ ÙŠØ§ ${ctx.from.first_name} Ù‚Ù… Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø§Ù‚ØªØ±Ø§Ø­Ùƒ Ø£Ùˆ Ø´ÙƒÙˆØ§Ùƒ ÙÙŠ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ø­Ø¯Ø© Ù…Ø¹ Ø°ÙƒØ± ÙƒØ§ÙØ© Ø§Ù„ØªÙØ§ØµÙŠÙ„ ÙˆØ³ÙˆÙ Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†`
    );
    await Storage.setItem(`complaint-${ctx.from.id}`, true);
    
});

bot.hears("ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø®Ø¯Ù…Ø© Ø§Ù„Ø²Ø¨Ø§Ø¦Ù†", async (ctx) => {
ctx.reply(
    "Ø§Ø®ØªØ± Ø·Ø±ÙŠÙ‚Ø© Ø§Ù„ØªÙˆØ§ØµÙ„ Ø§Ù„ØªÙŠ ØªØ±ØºØ¨ Ø¨Ù‡Ø§",    Markup.inlineKeyboard([
      [
        Markup.button.url(
          "ğŸŸ¢ ÙˆØ§ØªØ³Ø§Ø¨",
          "https://api.whatsapp.com/send?phone=+12675754741"
        ),
        Markup.button.url(
          "ğŸ”µ ØªÙ„ØºØ±Ø§Ù…",
          "https://t.me/@CustomerServiceTele"
        ),
      ]
      ])
      
);


});
// hear any text
bot.on("message", async (ctx) => {
  const balance = await Storage.getItem(`balance-${ctx.from.id}`);
  const username = await Storage.getItem(`username-${ctx.from.id}`);
  const complaint = await Storage.getItem(`complaint-${ctx.from.id}`);
  if (balance) {
    if (!username) {
      await Storage.setItem(`username-${ctx.from.id}`, true);
      ctx.reply(
        `Ù…Ù† ÙØ¶Ù„Ùƒ ÙŠØ§ ${ctx.from.first_name} Ù‚Ù… Ø¨Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø§Ù„Ø®Ø§ØµØ© Ø¨Ø­Ø³Ø§Ø¨Ùƒ ÙÙŠ Ø§ØªØµØ§Ù„Ø§Øª Ø³ÙˆØ±ÙŠØ§`
      );
    } else {
      const message = `Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø­Ø³Ø§Ø¨Ùƒ\n
    Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ Ù‡ÙŠ : \n
    <b> ğŸ‘¤  Ø§Ø³Ù… Ø§Ù„Ù…Ø´ØªØ±Ùƒ:</b> Ù…Ø­Ù…Ø¯ Ù…Ø­Ù…Ø¯ \n
    <b> ğŸ“  Ø±Ù‚Ù… Ø§Ù„Ø­Ø³Ø§Ø¨:</b> 222222@idlib.com \n
    <b> ğŸ’¼  Ø§Ù„Ø¨Ø§Ù‚Ø©:</b> 200GB \n
    <b> ğŸ’°  Ø§Ù„Ø±ØµÙŠØ¯ Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</b> 123.12GB \n
    <b> ğŸ“…  Ø§Ø®Ø± Ø´Ø­Ù†:</b> 2025-10-10 \n
    <b> ğŸŸ¢  Ø§Ù„Ø­Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø§Ù„Ø§Ù†ØªØ±Ù†Øª:</b> Ù†Ø´Ø·`;
      ctx.replyWithHTML(message);
      await Storage.setItem(`balance-${ctx.from.id}`, false);
      await Storage.setItem(`username-${ctx.from.id}`, false);
    }
  }else if(complaint){
    ctx.reply(
      `Ø´ÙƒØ±Ø§Ù‹ Ù„Ùƒ ÙŠØ§ ${ctx.from.first_name} Ø¹Ù„Ù‰ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù‚ØªØ±Ø§Ø­Ùƒ Ø£Ùˆ Ø´ÙƒÙˆØ§ÙƒØŒ Ø³Ù†Ù‚ÙˆÙ… Ø¨Ø§Ù„Ø±Ø¯ Ø¹Ù„ÙŠÙƒ ÙÙŠ Ø£Ù‚Ø±Ø¨ ÙˆÙ‚Øª Ù…Ù…ÙƒÙ†`
    );
    await Storage.setItem(`complaint-${ctx.from.id}`, false); 
  }
});
